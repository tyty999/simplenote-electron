(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1116:function(e,t,n){"use strict";n.r(t),n.d(t,"NoteEditor",(function(){return st}));var r=n(0),o=n.n(r),a=n(3),i=n.n(a),c=n(139),s=n(1095),u=n(274),l=n(244),f=n(149),d=function(e){var t=e.openShareDialog;return o.a.createElement("div",{className:"tag-email-tooltip"},o.a.createElement("div",{className:"tag-email-tooltip__arrow"}),o.a.createElement("div",{className:"tag-email-tooltip__inside"},"Collaboration has moved. Press the Share icon in the toolbar to access the ",o.a.createElement("a",{href:"#",onClick:t},"Collaborate screen"),"."))};d.propTypes={openShareDialog:i.a.func.isRequired};var p=Object(c.b)(null,(function(e){return{openShareDialog:function(){return e(Object(f.showDialog)("SHARE"))}}}))(d),h=n(4),g=n.n(h),v=function(e){var t=e.onSelect,n=e.selected,r=e.tagName;return o.a.createElement("div",{className:g()("tag-chip",{selected:n}),"data-tag-name":r,onClick:t},r)},y=n(5);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=O(e);if(t){var o=O(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return k(this,n)}}function k(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?C(e):t}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(e){return function(t){return t.trim().toLowerCase().startsWith(e.trim().toLowerCase())}},F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(i,e);var t,n,r,a=E(i);function i(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return b(this,i),T(C(e=a.call.apply(a,[this].concat(n))),"inputField",void 0),T(C(e),"inputObserver",void 0),T(C(e),"state",{isComposing:!1}),T(C(e),"completeSuggestion",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.identity,n=e.props,r=n.onChange,o=n.tagNames,a=n.value;if(a.length){var i=o.find(x(a));i&&r(i,(function(){t(i),e.focusInput()}))}})),T(C(e),"focusInput",(function(){if(e.inputField){var t=e.inputField;t.focus();var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var r=window.getSelection();r.removeAllRanges(),r.addRange(n)}})),T(C(e),"hasFocus",(function(){return document.activeElement===e.inputField})),T(C(e),"interceptKeys",(function(t){var n;return Object(y.invoke)((T(n={},13,e.submitTag),T(n,188,e.submitTag),T(n,9,e.interceptTabPress),T(n,39,e.interceptRightArrow),n),t.keyCode,t)})),T(C(e),"interceptRightArrow",(function(t){var n=e.props.value;window.getSelection().getRangeAt(0).endOffset===n.length&&(e.completeSuggestion(),t.preventDefault(),t.stopPropagation())})),T(C(e),"interceptTabPress",(function(t){e.completeSuggestion(e.submitTag),t.preventDefault(),t.stopPropagation()})),T(C(e),"onInputMutation",(function(t){t.forEach((function(t){var n=Object(y.get)(t,"target.data","");"childList"===t.type&&t.addedNodes.length&&(n=Object(y.get)(t,"target.innerText","")),e.onInput(n)}))})),T(C(e),"onInput",(function(t){e.state.isComposing||e.props.onChange(t.trim(),e.focusInput)})),T(C(e),"onCompositionEnd",(function(t){var n=t.target.textContent;e.setState({isComposing:!1},(function(){return e.onInput(n)}))})),T(C(e),"removePastedFormatting",(function(t){var n;Object(y.get)(t,"clipboardData.getData")?n=t.clipboardData.getData("text/plain"):Object(y.get)(window,"clipboardData.getData")&&(n=window.clipboardData.getData("Text")),e.onInput(n),t.preventDefault(),t.stopPropagation()})),T(C(e),"storeInput",(function(t){e.inputField=t,e.props.inputRef(t),Object(y.invoke)(C(e),"inputField.addEventListener","paste",e.removePastedFormatting,!1)})),T(C(e),"submitTag",(function(t){var n=e.props,r=n.onSelect,o=n.value;o.trim().length&&r(o.trim()),Object(y.invoke)(t,"preventDefault"),Object(y.invoke)(t,"stopPropagation")})),e}return t=i,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusInput(this.focusInput),this.props.storeHasFocus(this.hasFocus),this.inputObserver=new MutationObserver(this.onInputMutation),this.inputObserver.observe(this.inputField,{characterData:!0,childList:!0,subtree:!0})}},{key:"componentWillUnmount",value:function(){Object(y.invoke)(this,"inputField.removeEventListener","paste",this.removePastedFormatting,!1),this.inputObserver.disconnect()}},{key:"render",value:function(){var e=this,t=this.props,n=t.value,r=t.tagNames,a=n.length&&r.find(x(n)),i=""===n&&!this.state.isComposing;return o.a.createElement("div",{className:"tag-input",onClick:this.focusInput},i&&o.a.createElement("span",{"aria-hidden":!0,className:"tag-input__placeholder"},"Add a tag…"),o.a.createElement("div",{"aria-label":"Add a tag…",ref:this.storeInput,className:"tag-input__entry",contentEditable:"true",onCompositionStart:function(){return e.setState({isComposing:!0})},onCompositionEnd:this.onCompositionEnd,onKeyDown:this.interceptKeys,spellCheck:!1,suppressContentEditableWarning:!0},n),o.a.createElement("div",{className:"tag-input__suggestion",disabled:!0,type:"text"},a?a.substring(n.length):""))}}])&&w(t.prototype,n),r&&w(t,r),i}(r.Component);T(F,"displayName","TagInput"),T(F,"defaultProps",{inputRef:y.identity,onChange:y.identity,onSelect:y.identity,storeFocusInput:y.noop,storeHasFocus:y.noop});var N=F,j=n(11);function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A(e);if(t){var o=A(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I(this,n)}}function I(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?L(e):t}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(i,e);var t,n,r,a=K(i);function i(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return D(this,i),M(L(e=a.call.apply(a,[this].concat(n))),"focusInput",void 0),M(L(e),"hiddenTag",void 0),M(L(e),"inputHasFocus",void 0),M(L(e),"tagInput",void 0),M(L(e),"state",{selectedTag:"",tagInput:""}),M(L(e),"addTag",(function(t){var n=e.props,r=n.allTags,o=n.tags,a=t.trim().replace(/\s+/g,",").split(",");a.some(u.a)&&e.showEmailTooltip();var i=Object(y.union)(o,Object(y.intersectionBy)(r,a,(function(e){return e.toLocaleLowerCase()})),Object(y.differenceBy)(a,r,(function(e){return e.toLocaleLowerCase()})));e.updateTags(i),e.storeTagInput(""),Object(y.invoke)(L(e),"tagInput.focus"),j.a.tracks.recordEvent("editor_tag_added")})),M(L(e),"hasSelection",(function(){return e.state.selectedTag&&!!e.state.selectedTag.length})),M(L(e),"deleteTag",(function(t){var n=e.props.tags,r=e.state.selectedTag;e.updateTags(Object(y.differenceBy)(n,[t],(function(e){return e.toLocaleLowerCase()}))),r===t&&e.setState({selectedTag:""},(function(){var t;return null===(t=e.tagInput)||void 0===t?void 0:t.focus()})),j.a.tracks.recordEvent("editor_tag_removed")})),M(L(e),"deleteSelection",(function(){e.hasSelection()&&e.deleteTag(e.state.selectedTag)})),M(L(e),"hideEmailTooltip",(function(){return e.setState({showEmailTooltip:!1})})),M(L(e),"hasFocus",(function(){return e.inputHasFocus&&e.inputHasFocus()})),M(L(e),"focusTagField",(function(){return e.focusInput&&e.focusInput()})),M(L(e),"interceptKeys",(function(t){if(8===t.which){if(e.hasSelection()&&e.deleteSelection(),""!==e.state.tagInput)return;return e.selectLastTag(),void t.preventDefault()}if(39===t.which&&e.hasSelection())return e.unselect(t),void e.focusTagField();9===t.which&&e.hasSelection()&&e.unselect(t)})),M(L(e),"preventStealingFocus",(function(t){var n=t.ctrlKey,r=t.code,o=t.metaKey,a=t.shiftKey;if(e.props.keyboardShortcuts)return(n||o)&&a&&"KeyY"===r&&e.setState({selectedTag:""}),!0})),M(L(e),"updateTags",(function(t){return e.props.updateNoteTags({note:e.props.note,tags:t})})),M(L(e),"selectLastTag",(function(){return e.setState({selectedTag:e.props.tags.slice(-1).shift()})})),M(L(e),"selectTag",(function(t){var n=t.target.dataset.tagName;t.preventDefault(),t.stopPropagation(),e.deleteTag(n)})),M(L(e),"showEmailTooltip",(function(){e.setState({showEmailTooltip:!0}),setTimeout((function(){return e.setState({showEmailTooltip:!1})}),5e3)})),M(L(e),"onKeyDown",(function(t){return e.state.showEmailTooltip&&e.hideEmailTooltip(),e.interceptKeys(t)})),M(L(e),"storeFocusInput",(function(t){return e.focusInput=t})),M(L(e),"storeHasFocus",(function(t){return e.inputHasFocus=t})),M(L(e),"storeHiddenTag",(function(t){return e.hiddenTag=t})),M(L(e),"storeInputRef",(function(t){return e.tagInput=t})),M(L(e),"storeTagInput",(function(t,n){return e.setState({tagInput:t},n)})),M(L(e),"unselect",(function(t){e.state.selectedTag&&e.hiddenTag!==t.relatedTarget&&e.setState({selectedTag:""})})),e}return t=i,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusTagField(this.focusTagField),this.props.storeHasFocus(this.hasFocus),document.addEventListener("click",this.unselect,!0),window.addEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.unselect,!0),window.removeEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentDidUpdate",value:function(){this.hasSelection()&&this.hiddenTag.focus()}},{key:"render",value:function(){var e=this,t=this.props,n=t.allTags,r=t.tags,a=this.state,i=a.selectedTag,c=a.showEmailTooltip,l=a.tagInput;return o.a.createElement("div",{className:"tag-field"},o.a.createElement("div",{className:g()("tag-editor",{"has-selection":this.hasSelection()}),tabIndex:"-1",onKeyDown:this.onKeyDown},o.a.createElement("input",{className:"hidden-tag",tabIndex:"-1",ref:this.storeHiddenTag}),r.filter(Object(y.negate)(u.a)).map((function(t){return o.a.createElement(v,{key:t,tagName:t,selected:t===i,onSelect:e.selectTag})})),o.a.createElement(N,{allTags:n,inputRef:this.storeInputRef,value:l,onChange:this.storeTagInput,onSelect:this.addTag,storeFocusInput:this.storeFocusInput,storeHasFocus:this.storeHasFocus,tagNames:Object(y.differenceBy)(n,r,(function(e){return e.toLocaleLowerCase()}))}),o.a.createElement(s.a,{container:this,onHide:this.hideEmailTooltip,placement:"top",rootClose:!0,shouldUpdatePosition:!0,show:c,target:this.tagInput},(function(){return o.a.createElement(p,{note:e.props.note})}))))}}])&&P(t.prototype,n),r&&P(t,r),i}(r.Component);M(H,"displayName","TagField"),M(H,"defaultProps",{storeFocusTagField:y.noop,storeHasFocus:y.noop,tags:[]});var q=Object(c.b)((function(e){return{keyboardShortcuts:e.settings.keyboardShortcuts}}),{updateNoteTags:l.b})(H),B=n(33),U=n(794),W=n.n(U),Q=n(251);function z(e){return e.getCurrentContent().getPlainText("\n")}function X(e){var t=e.getSelection().focusKey;return e.getCurrentContent().getBlockForKey(t)}function $(e){var t=e.getCurrentContent(),n=e.getSelection(),r=n.getStartKey(),o=e.getCurrentContent().getBlockForKey(r),a=n.getStartOffset(),i=n.getEndKey(),c=n.getEndOffset();if(r===i)return o.getText().slice(a,c);var s="";s+=o.getText().slice(a)+"\n";for(var u=e.getCurrentContent().getBlockForKey(i),l=o;(l=t.getBlockAfter(l.key))&&l.key!==i;)s+=l.getText()+"\n";return s+=u.getText().slice(0,c)}function V(e,t){for(var n,r,o=e.getSelection().anchorKey,a=e.getSelection().focusKey,i=e.getCurrentContent().getBlocksAsArray(),c=0;c<i.length;c++)i[c].getKey()===o&&(n=c),i[c].getKey()===a&&(r=c);var s=t.getCurrentContent().getBlocksAsArray(),u=e.getSelection(),l=s.length-1,f=Math.min(n,l),d=Math.min(r,l),p=Math.min(u.getAnchorOffset(),s[f].getLength()),h=Math.min(u.getFocusOffset(),s[d].getLength());return t.getSelection().merge({anchorKey:s[f].getKey(),anchorOffset:p,focusKey:s[d].getKey(),focusOffset:h,isBackward:u.getIsBackward(),hasFocus:u.getHasFocus()})}var J=function(e){return Object(y.includes)(["-","*","+","- [ ]","- [x]","•"],e.trim())};function Y(e){var t=e.getSelection(),n=t.getStartOffset(),r=X(e).getText(),o=J(r)?0:n,a=Q.EditorState.push(e,Q.Modifier.replaceText(e.getCurrentContent(),t.isCollapsed()?t.merge({anchorOffset:o,focusOffset:o}):t,"\t"),"insert-characters");return Q.EditorState.forceSelection(a,a.getSelection().merge({anchorOffset:n+1,focusOffset:n+1}))}function G(e){var t=e.getSelection(),n=t.getStartOffset(),r=X(e).getText(),o=J(r),a=o?0:n-1,i=o?1:n;if("\t"!==r.slice(a,i))return e;var c=Q.EditorState.push(e,Q.Modifier.removeRange(e.getCurrentContent(),t.merge({anchorOffset:a,focusOffset:i})),"remove-range");return Q.EditorState.forceSelection(c,t.merge({anchorOffset:n-1,focusOffset:n-1}))}function Z(e){var t=Q.EditorState.push(e,Q.Modifier.removeRange(e.getCurrentContent(),e.getSelection().merge({anchorOffset:0,focusOffset:X(e).getLength()})),"remove-range");return Q.EditorState.forceSelection(t,t.getCurrentContent().getSelectionAfter())}function ee(e,t){var n=Q.EditorState.push(e,Q.Modifier.splitBlock(e.getCurrentContent(),e.getSelection()),"split-block"),r=Q.EditorState.push(n,Q.Modifier.insertText(n.getCurrentContent(),n.getCurrentContent().getSelectionAfter(),t),"insert-characters");return Q.EditorState.forceSelection(r,r.getCurrentContent().getSelectionAfter())}var te=n(221),ne=n(474),re=n.n(ne),oe=function(e){var t=e.children,n=e.className;return o.a.createElement("span",{className:n},t)};oe.propTypes={children:i.a.node.isRequired,className:i.a.string.isRequired};var ae=oe;function ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var se=function(e){return function(t,n){var r=t.getText();e&&r&&function(e,t){for(var n,r=[];null!==(n=t.exec(e));)r.push([n.index,t.lastIndex]);return r}(r,e).forEach(function(e){return function(t){var n=ie(t,2),r=n[0],o=n[1];return e(r,o,{className:"search-match"})}}(n))}},ue=function(e){return e?new re.a(se(e),ae):null},le=n(354),fe=n(40),de=n(887),pe=n.n(de),he=n(889),ge=n.n(he),ve={type:"output",regex:'<input type="checkbox" disabled',replace:'<input type="checkbox" '},ye=function(e){return n.e(8).then(n.t.bind(null,1113,7)).then((function(t){var n=t.default;n.extension("enableCheckboxes",ve);var r=new n.Converter({extensions:["enableCheckboxes"]});r.setFlavor("github"),r.setOption("simpleLineBreaks",!1),r.setOption("ghMentions",!1),r.setOption("smoothLivePreview",!0),r.setOption("tables",!0),r.setOption("strikethrough",!0);var o=e.replace(/([ \t\u2000-\u200a]*)\u2022(\s)/gm,"$1-$2");return function(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=t.createTreeWalker(t.body,NodeFilter.SHOW_ALL,null,!1),r=[],o=[],a=function(){var e=n.currentNode;if(function(e){switch(e.nodeName.toLowerCase()){case"head":case"html":case"iframe":case"link":case"meta":case"object":case"script":case"style":return!0;default:return!1}}(e))return o.push(e),"continue";if(!function(e){var t=e.nodeName.toLowerCase();if("input"===t)return"checkbox"===e.getAttribute("type");switch(t){case"#text":case"a":case"article":case"b":case"br":case"blockquote":case"cite":case"code":case"dd":case"del":case"div":case"dt":case"em":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"hr":case"i":case"img":case"ins":case"kbd":case"li":case"ol":case"p":case"pre":case"s":case"span":case"strong":case"sub":case"sup":case"table":case"tbody":case"td":case"th":case"thead":case"tr":case"tt":case"ul":return!0;default:return!1}}(e))return r.push(e),"continue";var t=e.nodeName.toLowerCase();Object(y.filter)(e.attributes,(function(e){var n=e.name,r=e.value;return!function(e,t,n){switch(e){case"a":switch(t){case"href":return!n.toLowerCase().trim().startsWith("javascript");case"alt":case"rel":case"title":return!0;default:return!1}case"img":switch(t){case"alt":case"src":case"title":case"width":return!0;default:return!1}case"input":switch(t){case"disabled":case"checked":case"type":return!0;default:return!1}case"li":switch(t){case"class":switch(n){case"task-list-item":return!0;default:return!1}default:return!1}case"ol":switch(t){case"start":return!0;default:return!1}case"th":case"td":switch(t){case"style":switch(n){case"text-align:center;":case"text-align:left;":case"text-align:right;":return!0;default:return!1}default:return!1}default:return!1}}(t,n,r)&&(("href"!==n&&"src"!==n||!ge.a.isWebUri(r))&&("href"!==n||!r.startsWith("mailto:")||!pe.a.validate(r.slice(7))))})).forEach((function(t){var n=t.name;return e.removeAttribute(n)}));var a="a"===t&&e.getAttribute("href");"a"!==t||"string"!=typeof a||a.startsWith("mailto:")||(e.setAttribute("target","_blank"),e.setAttribute("rel","external noopener noreferrer")),"li"===t&&"task-list-item"===e.getAttribute("class")&&e.setAttribute("style","list-style: none;")};n.nextNode();)a();return o.forEach((function(e){try{var t;null==e||null===(t=e.parentNode)||void 0===t||t.removeChild(e)}catch(e){}})),r.forEach((function(e){var t,n=e.parentNode;try{for(;t=e.firstChild;)null==n||n.insertBefore(t,e);null==n||n.removeChild(e)}catch(e){}})),t.body.innerHTML}(r.makeHtml(o))}))},me=n(197),be=function(e){var t=e.text,n=e.taskNodeIndex,r=function(e){var t={text:"",ids:[]};return t.text=e.replace(me.c,(function(e){var n=Object(fe.a)(8);return t.ids.push(n),e.replace(me.c,"$1"+"- [ ] ".concat(n))})),t}(t),o=r.text,a=r.ids;return ye(o).then((function(e){var t=function(e){var t=e.html,n=e.taskNodeIndex,r=(new DOMParser).parseFromString(t,"text/html").querySelectorAll(me.a.taskNode);return Array.from(r)[n].textContent.trim()}({html:e,taskNodeIndex:n});return a.indexOf(t)}))},we=function(e){var t=/- \[[xX]\]/;return t.test(e)?e.replace(t,"- [ ]"):e.replace(/- \[\s?\]/,"- [x]")},Se=function(e){var t=e.text,n=e.index,r=0;return t.replace(me.c,(function(e){return r++===n?we(e):e}))},Ee=function(e){var t=e.taskNode,n=e.text,r=t.ownerDocument.querySelectorAll("".concat(me.a.markdownRoot," ").concat(me.a.taskNode)),o=n.match(me.c).length!==r.length,a=Array.from(r).indexOf(t);return o?be({text:n,taskNodeIndex:a}).then((function(e){return Se({text:n,index:e})})):Promise.resolve(Se({text:n,index:a}))},ke=function(e){return new re.a((function(t,n){for(var r,o=t.getText(),a=function(){var o=r[1],a=r[2],i=r.index+Object(y.get)(o,"length",0),c=i+a.length,s=/[xX]/.test(a),u=Q.SelectionState.createEmpty(t.getKey()).merge({anchorOffset:i,focusOffset:c}),l=we(a);n(i,c,{checked:s,onChange:function(){return e(u,l)}})};null!==(r=me.c.exec(o));)a()}),le.a)},Ce=function(e,t){return Object(y.get)(e.getCurrentContent().getBlockForKey(t),"text",null)},Oe=function(e,t){var n=X(e),r=n.text,o=Ce(t,n.getKey());if(!(r!==o)||""===r)return!1;var a=Object(y.includes)(["backspace-character","remove-range"],e.getLastChangeType()),i=me.c.test(o)&&!r.match(me.c);return a&&i},Te=function(e,t){var n=X(e),r=n.text,o=Ce(t,n.getKey())[e.getSelection().focusOffset];if(!/[ \]]/.test(o))return Q.Modifier.insertText(e.getCurrentContent(),e.getSelection()," ");var a=Object(y.get)(r.match("-"),"index",0);return Q.Modifier.removeRange(e.getCurrentContent(),e.getSelection().merge({anchorOffset:a}),"backward")};function xe(e){for(var t=e.getCurrentContent(),n=e.getSelection(),r=n.getStartKey(),o=n.getEndKey(),a=t;r&&(a=Fe(r,a),r!==o);)r=t.getKeyAfter(r);var i=Q.EditorState.push(e,a,"insert-characters"),c=function(e,t,n){var r=Object(y.get)(e.focusKey,"key",e.focusKey),o=function(e){return e.getBlockForKey(r).getText().length},a=o(n)-o(t),i=e.focusOffset+a;return Q.SelectionState.createEmpty(r).merge({anchorOffset:i,focusOffset:i})}(n,t,a);return Q.EditorState.forceSelection(i,c)}function Fe(e,t){var n=t.getBlockForKey(e).getText();me.c.lastIndex=0;var r,o=me.c.exec(n);if(o){var a=o[1],i=o[2],c=o[3].match(/^\s*/)[0].length,s=a.length,u=Q.SelectionState.createEmpty(e).merge({anchorOffset:s,focusOffset:s+i.length+c});r=Q.Modifier.removeRange(t,u,"backward")}else{var l=n.match(/^\s*/)[0].length,f=Q.SelectionState.createEmpty(e).merge({anchorOffset:l,focusOffset:l});r=Q.Modifier.insertText(t,f,"- [ ] ")}return r}function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e,t){return(De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ie(e);if(t){var o=Ie(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _e(this,n)}}function _e(e,t){return!t||"object"!==Ne(t)&&"function"!=typeof t?Ke(e):t}function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ie(e){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}(i,e);var t,n,r,a=Pe(i);function i(){var e;je(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Le(Ke(e=a.call.apply(a,[this].concat(n))),"replaceRangeWithText",(function(t,n){var r=e.state.editorState,o=Q.Modifier.replaceText(r.getCurrentContent(),t,n);e.handleEditorStateChange(Q.EditorState.push(r,o,"replace-text"))})),Le(Ke(e),"generateDecorators",(function(t){return Object(te.a)(t)?new W.a([ue(Object(te.c)(t)),ke(e.replaceRangeWithText)]):ke(e.replaceRangeWithText)})),Le(Ke(e),"createNewEditorState",(function(e,t){var n=Q.EditorState.createWithContent(Q.ContentState.createFromText(e,"\n"));return""===e&&""===t?Q.EditorState.moveFocusToEnd(n):n})),Le(Ke(e),"state",{editorState:e.createNewEditorState(e.props.content.text,e.props.searchQuery)}),Le(Ke(e),"editorKey",0),Le(Ke(e),"handleEditorStateChange",(function(t){var n=e.state.editorState;if(t!==n){var r=t;if(Oe(t,n)){var o=Te(t,n);r=Q.EditorState.push(t,o,"remove-range")}var a=z(r),i=z(n),c=a!==i?function(){return e.props.onChangeContent(a)}:y.noop;e.setState({editorState:r},c)}})),Le(Ke(e),"reflectChangesFromReceivedContent",(function(t,n){var r=Q.EditorState.push(t,Q.ContentState.createFromText(n,"\n"),"replace-text");if(t.getSelection().getHasFocus()){var o=V(t,r);r=Q.EditorState.forceSelection(r,o)}e.setState({editorState:r})})),Le(Ke(e),"queueDecoratorUpdate",Object(y.debounce)((function(){var t=e.props.searchQuery,n=e.state.editorState;null!==e.props.noteId&&e.setState({editorState:Q.EditorState.set(n,{decorator:e.generateDecorators(t)})})}),500)),Le(Ke(e),"saveEditorRef",(function(t){e.editor=t})),Le(Ke(e),"focus",(function(){Object(y.invoke)(Ke(e),"editor.focus")})),Le(Ke(e),"hasFocus",(function(){return document.activeElement===Object(y.get)(e.editor,"editor")})),Le(Ke(e),"onTab",(function(t){var n=e.state.editorState;t.preventDefault(),!n.getSelection().isCollapsed()&&t.shiftKey||t.altKey||t.ctrlKey||t.metaKey||e.handleEditorStateChange(t.shiftKey?G(n):Y(n))})),Le(Ke(e),"handleReturn",(function(){var t=e.state.editorState,n=X(t).getText(),r=n.search(/\S/),o=function(e){var n=t.getSelection(),r=n.anchorOffset,o=n.focusOffset;return r===e&&o===e};if(o(0)||o(r))return"not-handled";if(J(n))return e.handleEditorStateChange(Z(t)),"handled";var a=n.match(/^[ \t\u2000-\u200a]*[-*+\u2022]\s/);if(n.match(me.c)){var i=n.replace(me.c,"$1- [ ] ");return e.handleEditorStateChange(ee(t,i)),"handled"}return a?(e.handleEditorStateChange(ee(t,a[0])),"handled"):"not-handled"})),Le(Ke(e),"handleKeydown",(function(t){if(e.props.keyboardShortcuts){var n=t.code,r=t.ctrlKey,o=t.metaKey,a=t.shiftKey;return!(r||o)||!a||"KeyC"!==n||(e.handleEditorStateChange(xe(e.state.editorState)),j.a.tracks.recordEvent("editor_checklist_inserted"),t.stopPropagation(),t.preventDefault(),!1)}})),Le(Ke(e),"onAppCommand",(function(t){"insertChecklist"===t.action&&(e.handleEditorStateChange(xe(e.state.editorState)),j.a.tracks.recordEvent("editor_checklist_inserted"))})),Le(Ke(e),"copyPlainText",(function(t){var n=$(e.state.editorState);n&&(t.clipboardData.setData("text/plain",n),t.preventDefault())})),e}return t=i,(n=[{key:"componentDidMount",value:function(){var e;this.props.storeFocusEditor(this.focus),this.props.storeHasFocus(this.hasFocus),this.editor.blur(),null===(e=window.electron)||void 0===e||e.receive("appCommand",this.onAppCommand),window.addEventListener("keydown",this.handleKeydown,!1),this.queueDecoratorUpdate(),this.queueDecoratorUpdate.flush()}},{key:"componentDidUpdate",value:function(e){var t=this,n=this.props,r=n.content,o=n.searchQuery,a=n.noteId,i=n.spellCheckEnabled,c=this.state.editorState;i!==e.spellCheckEnabled&&(this.editorKey+=1,this.forceUpdate()),a===e.noteId&&r.version===e.content.version?(o!==e.searchQuery&&this.queueDecoratorUpdate(),r.text!==e.content.text&&r.hasRemoteUpdate&&this.reflectChangesFromReceivedContent(c,r.text)):this.setState({editorState:this.createNewEditorState(r.text,o)},(function(){t.queueDecoratorUpdate(),r.text.length<1e4&&t.queueDecoratorUpdate.flush()}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeydown,!1)}},{key:"render",value:function(){return o.a.createElement("div",{onCopy:this.copyPlainText,onCut:this.copyPlainText,style:{height:"100%"}},o.a.createElement(Q.Editor,{key:this.editorKey,ref:this.saveEditorRef,spellCheck:this.props.spellCheckEnabled,stripPastedStyles:!0,onChange:this.handleEditorStateChange,editorState:this.state.editorState,onTab:this.onTab,handleReturn:this.handleReturn}))}}])&&Re(t.prototype,n),r&&Re(t,r),i}(r.Component);Le(Ae,"propTypes",{content:i.a.shape({text:i.a.string.isRequired,hasRemoteUpdate:i.a.bool.isRequired,version:i.a.number}),noteId:i.a.string,onChangeContent:i.a.func.isRequired,spellCheckEnabled:i.a.bool.isRequired,storeFocusEditor:i.a.func,storeHasFocus:i.a.func}),Le(Ae,"defaultProps",{storeFocusEditor:y.noop,storeHasFocus:y.noop});var Me=Object(c.b)((function(e){var t=e.ui,n=t.searchQuery;t.showNoteList;return{keyboardShortcuts:e.settings.keyboardShortcuts,searchQuery:n}}))(Ae),He=n(407),qe=function(e,t,r){ye(t).then((function(t){return e.innerHTML=t,e})).then((function(e){if(!r)return e.querySelectorAll("pre code");var t=Object(te.b)(r).map((function(e){return e.toLocaleLowerCase()}));if(!t.length)return e.querySelectorAll("pre code");for(var n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return t.some((function(t){var n;return null===(n=e.textContent)||void 0===n?void 0:n.toLocaleLowerCase().includes(t)}))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1),o=[],a=n.currentNode;a;)o.push(a),a=n.nextNode();return o.forEach((function(e){return function e(t,n){var r=t.parentNode;n.forEach((function(t){r.childNodes.forEach((function(r){var o,a,i;if(r.nodeType===Node.TEXT_NODE&&(null===(o=r.textContent)||void 0===o?void 0:o.toLocaleLowerCase().includes(t))){var c=null===(a=r.textContent)||void 0===a?void 0:a.toLocaleLowerCase().indexOf(t),s=r.splitText(c),u=s.splitText(t.length),l=document.createElement("span");l.setAttribute("class","search-match"),null===(i=s.parentNode)||void 0===i||i.replaceChild(l,s),l.appendChild(s),e(u,n)}}))}))}(e,t)})),e.querySelectorAll("pre code")})).then((function(e){if(e.length)return n.e(4).then(n.t.bind(null,1114,7)).then((function(t){var n=t.default;e.forEach(n.highlightBlock)})).catch()}))};function Be(e){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ve(e);if(t){var o=Ve(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Xe(this,n)}}function Xe(e,t){return!t||"object"!==Be(t)&&"function"!=typeof t?$e(e):t}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(c,e);var t,n,a,i=ze(c);function c(){var e;Ue(this,c);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Je($e(e=i.call.apply(i,[this].concat(n))),"noteDetail",Object(r.createRef)()),Je($e(e),"previewNode",Object(r.createRef)()),Je($e(e),"focusEditor",(function(){return e.focusContentEditor&&e.focusContentEditor()})),Je($e(e),"isValidNote",(function(e){return e&&e.id})),Je($e(e),"copyRenderedNote",(function(t){var n=e.props,r=n.previewingMarkdown,o=n.showNoteInfo,a=n.isDialogOpen;if(!r)return!0;if(o||a)return!0;if(!document.getSelection().isCollapsed)return!0;var i=document.createDocumentFragment(),c=document.createElement("div");qe(c,e.props.note.data.content),i.appendChild(c),t.clipboardData.setData("text/plain",c.innerHTML),t.preventDefault()})),Je($e(e),"hasFocus",(function(){return e.editorHasFocus&&e.editorHasFocus()})),Je($e(e),"onPreviewClick",(function(t){for(var n=e.props,r=n.note,o=n.onChangeContent,a=n.syncNote,i=t.target;null!==i;i=i.parentNode){if("A"===i.tagName){t.preventDefault(),i.href.startsWith("http://localhost")||Object(B.a)(i.href);break}if("task-list-item"===i.className){t.preventDefault(),Ee({taskNode:i,text:r.data.content}).then((function(e){o(r,e),a(r.id)}));break}}})),Je($e(e),"saveNote",(function(t){var n=e.props.note;e.isValidNote(n)&&(e.props.onChangeContent(n,t),e.queueNoteSync(),j.a.tracks.recordEvent("editor_note_edited"))})),Je($e(e),"syncNote",(function(){var t=e.props.note;e.isValidNote(t)&&e.props.syncNote(t.id)})),Je($e(e),"storeEditorHasFocus",(function(t){return e.editorHasFocus=t})),Je($e(e),"storeFocusContentEditor",(function(t){return e.focusContentEditor=t})),Je($e(e),"updateMarkdown",(function(){e.props.previewingMarkdown&&e.props.note&&e.previewNode.current&&qe(e.previewNode.current,e.props.note.data.content,e.props.searchQuery)})),Je($e(e),"handlePreviewKeydown",(function(t){if(e.props.keyboardShortcuts){var n,r,o,a=t.ctrlKey,i=t.code,c=t.metaKey,s=t.shiftKey,u=a||c;if(e.noteDetail.current&&e.props.searchQuery.trim()&&u&&"KeyG"===i){t.stopPropagation(),t.preventDefault();var l=e.noteDetail.current.querySelectorAll("span.search-match");if(!l.length)return;var f=e.noteDetail.current.querySelector("span.search-match[data-current-match=true]"),d=s?l[l.length-1]:l[0];if(f){for(var p=0;p<l.length;p++)if(l[p]===f){d=l[(n=p+(s?-1:1),r=l.length,o=void 0,o=n%r,-1===o?r-1:o)];break}f.removeAttribute("data-current-match")}d.scrollIntoView({block:"center"}),d.setAttribute("data-current-match","true"),e.setState({selectedMatch:d})}}})),e}return t=c,(n=[{key:"componentWillMount",value:function(){this.queueNoteSync=Object(y.debounce)(this.syncNote,2e3),document.addEventListener("copy",this.copyRenderedNote,!1)}},{key:"componentDidMount",value:function(){var e=this.props.previewingMarkdown;this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus),window.addEventListener("beforeunload",this.queueNoteSync.flush),window.addEventListener("keydown",this.handlePreviewKeydown,!0),e&&this.updateMarkdown()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=Object(y.get)(this.props,["note","id"],!1);!1!==t&&Object(y.get)(e,["note","id"])!==t&&this.queueNoteSync.flush()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.note,r=t.previewingMarkdown,o=t.searchQuery,a=Object(y.get)(e,"note.data.content",""),i=Object(y.get)(this.props,"note.data.content","");(r&&(e.note!==n||a!==i||e.searchQuery!==o)||!e.previewingMarkdown&&this.props.previewingMarkdown)&&this.updateMarkdown()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.queueNoteSync.flush),document.removeEventListener("copy",this.copyRenderedNote,!1),window.removeEventListener("keydown",this.handlePreviewKeydown,!0)}},{key:"render",value:function(){var e=this.props,t=e.note,n=e.fontSize,r=e.previewingMarkdown,a=e.spellCheckEnabled,i={text:Object(y.get)(t,"data.content",""),hasRemoteUpdate:Object(y.get)(t,"hasRemoteUpdate",!1),version:Object(y.get)(t,"version",void 0)},c={fontSize:"".concat(n,"px")};return o.a.createElement("div",{className:"note-detail-wrapper"},t?o.a.createElement("div",{ref:this.noteDetail,className:"note-detail"},r&&o.a.createElement("div",{ref:this.previewNode,className:"note-detail-markdown theme-color-bg theme-color-fg","data-markdown-root":!0,onClick:this.onPreviewClick,style:c}),!r&&o.a.createElement("div",{className:"note-detail-textarea theme-color-bg theme-color-fg",style:c},o.a.createElement(Me,{spellCheckEnabled:a,storeFocusEditor:this.storeFocusContentEditor,storeHasFocus:this.storeEditorHasFocus,noteId:Object(y.get)(t,"id",null),content:i,onChangeContent:this.saveNote}))):o.a.createElement("div",{className:"note-detail-placeholder"},o.a.createElement(He.a,null)))}}])&&We(t.prototype,n),a&&We(t,a),c}(r.Component);Je(Ye,"displayName","NoteDetail"),Je(Ye,"propTypes",{fontSize:i.a.number,onChangeContent:i.a.func.isRequired,syncNote:i.a.func.isRequired,note:i.a.object,noteBucket:i.a.object.isRequired,previewingMarkdown:i.a.bool,spellCheckEnabled:i.a.bool.isRequired,storeFocusEditor:i.a.func,storeHasFocus:i.a.func}),Je(Ye,"defaultProps",{storeFocusEditor:y.noop,storeHasFocus:y.noop});var Ge=Object(c.b)((function(e){var t=e.ui,n=e.settings;return{isDialogOpen:t.dialogs.length>0,keyboardShortcuts:n.keyboardShortcuts,note:t.selectedRevision||t.note,searchQuery:t.searchQuery,showNoteInfo:t.showNoteInfo,spellCheckEnabled:n.spellCheckEnabled}}))(Ye);function Ze(e){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nt(e,t){return(nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=it(e);if(t){var o=it(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ot(this,n)}}function ot(e,t){return!t||"object"!==Ze(t)&&"function"!=typeof t?at(e):t}function at(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function it(e){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var st=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nt(e,t)}(i,e);var t,n,r,a=rt(i);function i(){var e;et(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ct(at(e=a.call.apply(a,[this].concat(n))),"markdownEnabled",(function(){var t=e.props.revision||e.props.note;return t&&t.data&&t.data.systemTags&&-1!==t.data.systemTags.indexOf("markdown")})),ct(at(e),"handleShortcut",(function(t){if(e.props.keyboardShortcuts){var n,r,o,a,i=t.code,c=t.ctrlKey,s=t.metaKey,u=t.shiftKey,l=e.props,f=l.note,d=l.revision,p=l.toggleMarkdown,h=c||s;return!d&&f&&h&&u&&"KeyM"===i?(p(f,!e.markdownEnabled()),t.stopPropagation(),t.preventDefault(),!1):h&&u&&"KeyP"===i&&e.markdownEnabled()?(e.props.toggleEditMode(),t.stopPropagation(),t.preventDefault(),!1):!(u&&h&&"KeyY"===i&&e.props.isEditorActive)||(e.editFieldHasFocus()?(null===(n=(r=e).focusTagField)||void 0===n||n.call(r),t.stopPropagation(),t.preventDefault(),!1):(null===(o=(a=e).focusNoteEditor)||void 0===o||o.call(a),t.stopPropagation(),t.preventDefault(),!1))}})),ct(at(e),"editFieldHasFocus",(function(){return e.editorHasFocus&&e.editorHasFocus()})),ct(at(e),"storeEditorHasFocus",(function(t){return e.editorHasFocus=t})),ct(at(e),"storeFocusEditor",(function(t){return e.focusNoteEditor=t})),ct(at(e),"storeFocusTagField",(function(t){return e.focusTagField=t})),ct(at(e),"storeTagFieldHasFocus",(function(t){return e.tagFieldHasFocus=t})),ct(at(e),"tagFieldHasFocus",(function(){return e.tagFieldHasFocus&&e.tagFieldHasFocus()})),ct(at(e),"toggleShortcuts",(function(t){t?window.addEventListener("keydown",e.handleShortcut,!0):window.removeEventListener("keydown",e.handleShortcut,!0)})),e}return t=i,(n=[{key:"componentDidMount",value:function(){this.toggleShortcuts(!0)}},{key:"componentWillUnmount",value:function(){this.toggleShortcuts(!1)}},{key:"render",value:function(){var e=this.props,t=e.editMode,n=e.note,r=e.noteBucket,a=e.fontSize,i=this.props.revision||n,c=i&&i.data&&i.data.tags||[],s=!(!n||!n.data.deleted);return o.a.createElement("div",{className:"note-editor theme-color-bg theme-color-fg"},o.a.createElement(Ge,{storeFocusEditor:this.storeFocusEditor,storeHasFocus:this.storeEditorHasFocus,noteBucket:r,previewingMarkdown:this.markdownEnabled()&&!t,onChangeContent:this.props.onUpdateContent,syncNote:this.props.syncNote,fontSize:a}),n&&!s&&o.a.createElement(q,{storeFocusTagField:this.storeFocusTagField,storeHasFocus:this.storeTagFieldHasFocus,allTags:this.props.allTags.map(Object(y.property)("data.name")),note:this.props.note,tags:c}))}}])&&tt(t.prototype,n),r&&tt(t,r),i}(r.Component);ct(st,"displayName","NoteEditor"),ct(st,"propTypes",{allTags:i.a.array.isRequired,isEditorActive:i.a.bool.isRequired,noteBucket:i.a.object.isRequired,fontSize:i.a.number,onUpdateContent:i.a.func.isRequired,revision:i.a.object,syncNote:i.a.func.isRequired}),ct(st,"defaultProps",{note:{data:{tags:[]}}});t.default=Object(c.b)((function(e){var t=e.appState,n=e.settings,r=e.tags,o=e.ui,a=o.note,i=o.editMode,c=o.selectedRevision;return{allTags:r,fontSize:n.fontSize,editMode:i,keyboardShortcuts:n.keyboardShortcuts,isEditorActive:!t.showNavigation,note:a,revision:c}}),(function(e){return{toggleNoteList:function(){return e(Object(f.toggleNoteList)())},toggleMarkdown:function(t,n){return e(Object(f.markdownNote)(t,n))},toggleEditMode:function(){return e(Object(f.toggleEditMode)())}}}))(st)},197:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a}));var r={taskNode:".task-list-item",markdownRoot:"[data-markdown-root]"},o=/^(\s*)(-[ \t]+\[[xX\s]?\])/gm,a=/^(\s*)(-[ \t]+\[[xX\s]?\])(.+)/gm},354:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(3),i=n.n(a);function c(){return o.a.createElement("svg",{className:"icon-checkmark",xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24"},o.a.createElement("path",{d:"M11,17.768l-4.884-4.884l1.768-1.768L11,14.232l8.658-8.658C17.823,3.391,15.075,2,12,2C6.477,2,2,6.477,2,12 s4.477,10,10,10s10-4.477,10-10c0-1.528-0.353-2.971-0.966-4.266L11,17.768z"}))}function s(){return o.a.createElement("svg",{className:"icon-circle",xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24"},o.a.createElement("g",{transform:"translate(2 2)"},o.a.createElement("path",{d:"m10 0c-5.523 0-10 4.477-10 10s4.477 10 10 10 10-4.477 10-10-4.477-10-10-10zm0 18.5c-4.694 0-8.5-3.806-8.5-8.5s3.806-8.5 8.5-8.5 8.5 3.806 8.5 8.5-3.806 8.5-8.5 8.5z"})))}var u=function(e){var t=e.checked,n=void 0!==t&&t,r=e.onChange;return o.a.createElement("span",{className:"checkbox",role:"checkbox","aria-checked":n,onClick:r,tabIndex:"0"},o.a.createElement("span",{className:"checkbox__icon","aria-hidden":"true"},n?o.a.createElement(c,null):o.a.createElement(s,null)))};u.propTypes={checked:i.a.bool,onChange:i.a.func};t.a=u}}]);